deps = [
    'umd-stdlib/core/StandardApplication'
    'custom/resources'
    'custom/menu'
]

factory = (require, StandardApplication, resources, menu)->

    class Applicaton extends StandardApplication
        beforeHistory: (queryParams, next)->
            @addResources resources
            regions = @layout.regions

            require ['umd-stdlib/core/common', 'umd-stdlib/views/HeaderView', 'umd-stdlib/views/MenuView'], (com, HeaderView, MenuView)->
                $ = com.$
                $header = regions.header.$el
                $menu = regions.menu.$el

                headerView = new HeaderView()
                $header.append headerView.$el
                headerView.render()

                menuView = new MenuView menu: menu
                $menu.append menuView.$el
                menuView.render()

                # Resize event are fired on scroll on chrome android
                # backup for real resize detection
                document_height = null
                $(window).on 'resize', (evt)->
                    _height = $(document).height()
                    return if document_height is _height
                    document_height = _height
                    $menu.removeAttr 'style'
                    height = _height - $header.height()
                    menuView.$el.css 'height', height - 20
                    $('.app-layout').css 'height', height
                    return
                $(window).trigger 'resize'

                next()
                return

            return
